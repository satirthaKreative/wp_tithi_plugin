!function(o){"use strict";var e=angular.module("YouzerWallApp",[]);e.controller("YouzerWallController",["$scope",function(e){}]),e.directive("linkPreview",["$compile","$http","$sce",function(a,u,g){var c=Youzer.youzer_url+"includes/public/core/functions/live-preview/",d=/((https?|ftp)\:\/\/)?([a-z0-9+!*(),;?&=\$_.-]+(\:[a-z0-9+!*(),;?&=\$_.-]+)?@)?([a-z0-9-.]*)\.([a-z]{2,3})(\:[0-9]{2,5})?(\/([a-z0-9+\$_\-~@\(\)\%]\.?)+)*\/?(\?[a-z+&\$_.-][a-z0-9;:@&#%=+\/\$_.-]*)?(#[a-z_.-][a-z0-9+\$_.-]*)?/i,e=function(e){e.currentImageIndex=1,e.preview={id:-1,text:"",title:"",url:"",pageUrl:"",canonicalUrl:"",description:"",image:"",images:[],video:"",videoIframe:""},e.showIframe=!1,e.hidePreview=!0,e.hideLoading=!0,e.isFetching=!1,e.allowPosting=!1,e.rightArrowDisabled=!0,e.leftArrowDisabled=!0,e.noThumbnail=!1,e.noImage=!1,e.previewTitleEditing=!1,e.previewDescriptionEditing=!1,e.imageAmount=angular.isDefined(e.imageAmount)?e.imageAmount:-1,e.cancelButtonClass=angular.isDefined(e.cancelButtonClass)?e.cancelButtonClass:"danger",e.loadingText=angular.isDefined(e.loadingText)?e.loadingText:YouzerLP.loading,e.loadingImage=angular.isDefined(e.loadingImage)?e.loadingImage:c+"img/empty.png",e.thubmnailText=angular.isDefined(e.thubmnailText)?e.thubmnailText:YouzerLP.choose_thumnnail,e.noThubmnailText=angular.isDefined(e.noThubmnailText)?e.noThubmnailText:YouzerLP.no_thumbnail,e.thumbnailPagination=angular.isDefined(e.thumbnailPagination)?e.thumbnailPagination:"%N of %N",e.defaultTitle=angular.isDefined(e.defaultTitle)?e.defaultTitle:YouzerLP.enter_title,e.defaultDescription=angular.isDefined(e.defaultDescription)?e.defaultDescription:YouzerLP.enter_desc};return{restrict:"E",scope:{placeholder:"@placeholder",imageAmount:"@iamount",buttonClass:"@bclass",buttonText:"@btext",cancelButtonClass:"@cbclass",cancelButtonText:"@cbtext",loadingText:"@ltext",loadingImage:"@limage",thubmnailText:"@ttext",noThubmnailText:"@nttext",thumbnailPagination:"@tpage",defaultTitle:"@dtitle",defaultDescription:"@ddescription"},link:function(t,n,e){o(".lp-preview-no-thubmnail-text input").on("change",function(){this.checked?o("#yz-wall-form .lp-prepost").addClass("yz-lp-no-thumbnail"):o("#yz-wall-form .lp-prepost").removeClass("yz-lp-no-thumbnail")}),o(".yz-wall-textarea").bind({paste:function(){setTimeout(function(){t.textCrawling(o(this).val(),t,n,a)},100)},keyup:function(e){13!=e.which&&32!=e.which&&17!=e.which||t.textCrawling(o(this).val(),t,n,a)}}),o(".yz-wall-textarea").on("paste",function(e,i){setTimeout(function(){t.textCrawling(o(this).val(),t,n,a)},100)}),o(".yz-wall-textarea").on("keyup",function(e,i){13!=i.which&&32!=i.which&&17!=i.which||t.textCrawling(o(this).val(),t,n,a)}),o(n.find("input")[0]).bind({keyup:function(e){13==e.which&&(t.previewTitleEditing=!1,a(n.find("input")[0])(t))}}),o(n.find("textarea")[1]).bind({keyup:function(e){13==e.which&&(t.previewDescriptionEditing=!1,a(n.find("textarea")[1])(t))}}),t.$watchGroup(["hideLoading","hidePreview","allowPosting","preview","isFetching","posts","noThumbnail","noImage"],function(e,i,t){t.hideLoading=e[0],t.hidePreview=e[1],t.allowPosting=e[2],t.preview=e[3],t.isFetching=e[4],t.posts=e[5],t.noThumbnail=e[6],t.noImage=e[7]})},controller:function(l){l.posts=[],e(l),l.textCrawling=function(e,i,t,n){if(!l.isFetching&&""!==e&&(r=e,d.test(r))){l.hidePreview=!0,l.hideLoading=!1,l.isFetching=!0,l.allowPosting=!1;var a=c+"textCrawler.php",o=angular.toJson({text:e,imageAmount:l.imageAmount});u({url:a,method:"POST",data:"data="+window.btoa(encodeURIComponent(o)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,i,t,n){l.preview=e,l.preview.video&&(l.videoIframeHTML=g.trustAsHtml(e.videoIframe)),l.hasEmptyInfo(l),l.hidePreview=!1,l.hideLoading=!0,l.allowPosting=!0,l.preview.image&&(l.enablePagination(l),l.updatePagination(l))})}var r},l.hasEmptyInfo=function(e){""==e.preview.title&&(e.preview.title=e.defaultTitle),""==e.preview.description&&(e.preview.description=e.defaultDescription)},l.enablePagination=function(e){var i=""===e.preview.image||null===e.preview.image;e.noThumbnail=i,e.noImage=i,e.leftArrowDisabled=1==e.preview.images.length,e.rightArrowDisabled=1==e.preview.images.length},l.updatePagination=function(e){var i=e.thumbnailPagination;i=(i=i.replace("%N",e.currentImageIndex)).replace("%N",e.preview.images.length),e.thumbnailPaginationText=i,e.leftArrowDisabled=1==e.currentImageIndex,e.rightArrowDisabled=e.currentImageIndex==e.preview.images.length},l.previousImage=function(){1!=l.currentImageIndex&&(l.currentImageIndex--,l.setNewPreviewImage(l.currentImageIndex))},l.nextImage=function(){l.currentImageIndex!=l.preview.images.length&&(l.currentImageIndex++,l.setNewPreviewImage(l.currentImageIndex))},l.setNewPreviewImage=function(e){l.preview.image=l.preview.images[e-1],l.updatePagination(l,e)},l.editPreviewTitle=function(){l.previewTitleEditing=!0},l.editPreviewDescription=function(){l.previewDescriptionEditing=!0},l.resetPreview=function(){e(l)},l.imageAction=function(e){0==e.video?window.open(e.pageUrl,"_blank"):l.showIframe=!0},l.hidePlay=function(e){return 0==e.video||1==l.showIframe},l.layoutWithoutImage=function(e){return""==e.image||1==l.showIframe},l.layoutWithImage=function(e){return""!=e.image||1==e.video&&0==l.showIframe}},templateUrl:function(e,i){return c+"template.html"}}}])}(jQuery);