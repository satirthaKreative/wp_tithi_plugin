!function(d){"use strict";d(document).ready(function(){var e=0,t=null,r=d("#yz-wall-form");d(".yz-wall-upload-btn").click(function(e){if(!d.yz_CheckFilesNumber()||r.find(".yz-file-progress")[0])return!1;d("#yz-upload-attachments").click(),e.preventDefault()}),d("#yz-upload-attachments").change(function(e){e.preventDefault();var a=d("#yz-upload-attachments").get(0);t=a,d.yz_UploadFiles({attachments:a,max_size:Yz_Wall.max_size,max_number:20,allowed_extensions:["png","jpg","jpeg","gif","mp4","ogv","ogg","mp3","wav","webm"]})}),d.yz_validate_attachment=function(e,a){var t=d.extend({allowed_extensions:["jpg","jpeg","gif","png"],max_number:3,max_size:3},a);if(e.size>1048576*t.max_size)return d.yz_DialogMsg("error",Yz_Wall.invalid_file_size),!1;if(!d.yz_CheckFilesNumber())return!1;if(r.find(".yz-attachment-item").length+1>t.max_number)return d.yz_DialogMsg("error",Yz_Wall.invalid_files_number),!1;var i=e.name.split(".").pop().toLowerCase();if(d.yz_isPostType("video")){var l=Yz_Wall.video_extentions;if(-1==d.inArray(i,l))return d.yz_DialogMsg("error",Yz_Wall.invalid_video_ext),!1}if(d.yz_isPostType("photo")||d.yz_isPostType("slideshow")){var n=Yz_Wall.image_extentions;if(-1==d.inArray(i,n))return d.yz_DialogMsg("error",Yz_Wall.invalid_image_ext),!1}if(d.yz_isPostType("file")){var s=Yz_Wall.file_extentions;if(-1==d.inArray(i,s))return d.yz_DialogMsg("error",Yz_Wall.invalid_file_ext),!1}if(d.yz_isPostType("audio")){var o=Yz_Wall.audio_extentions;if(-1==d.inArray(i,o))return d.yz_DialogMsg("error",Yz_Wall.invalid_audio_ext),!1}return!0},d.yz_UploadFiles=function(e){for(var a=d.extend({allowed_extensions:Yz_Wall.default_extentions,max_number:3,max_size:3},e),t=a.attachments.files,i=0;i<t.length;i++){var l=t[i];if(!d.yz_validate_attachment(l,a))return!1;var n=d.youzerAttachmentItem({file:l,file_name:l.name});d(".yz-form-attachments").append(n),0==i&&d.yz_UploadFile(l)}},d.youzerAttachmentItem=function(e){var a,t=d.extend({},e);return a='<div class="yz-attachment-item yz-file-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i><span class="yz-file-name">'+d.yz_GetNameExcerpt(t.file_name)+'</span></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>','<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>',d.yz_CheckIsFileImage(t.file)?'<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>':a},d.yz_UploadFile=function(n){var s=r.find(".yz-file-progress:first").parent(".yz-attachment-item"),e=new FormData;e.append("image",n),e.append("action","yz_upload_wall_attachments"),e.append("security",r.find('input[name="security"]').val()),d.ajax({type:"POST",url:Youzer.ajax_url,data:e,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=d.ajaxSettings.xhr();return e.upload&&(d(".yz-wall-actions .yz-wall-post").attr("disabled",!0),e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.total,t=100*e.loaded/a,i=s.find(".yz-file-upload");s.find(".yz-file-icon").attr("class","fas fa-spinner fa-spin yz-file-icon"),i.css("width",t+"%"),100<=t&&i.addClass("yz-file-uploaded")}})),e},success:function(e){var a=d.parseJSON(e);if(a.error)return d.yz_DialogMsg("error",a.error),s.remove(),d.yz_CheckUploadProgress(),!1;s.find(".yz-file-progress").fadeOut(400,function(){d(this).remove(),d.yz_upload_next_file(),d.yz_CheckUploadProgress()}),d.yz_CheckIsFileImage(n)&&s.find(".yz-file-icon").remove(),s.find(".yz-file-icon").attr("class","fas fa-paperclip yz-file-icon"),s.find(".yz-attachment-details").append('<i class="fas fa-trash-alt yz-delete-attachment"></i>'),s.find(".yz-attachment-data").val(e);var t=d.parseJSON(e),i=d.map(t,function(e){return e.original}),l=Yz_Wall.base_url+"/temp/"+i[0];s.css("background-image","url("+l+")")},error:function(e,a,t){s.remove(),d.yz_DialogMsg("error",a),d.yz_CheckUploadProgress(),d.yz_upload_next_file()}})},d.yz_upload_next_file=function(){e++,void 0!==t.files[e]&&d.yz_UploadFile(t.files[e])},d.yz_GetNameExcerpt=function(e){if(e.length<=25)return e;var a=25-"...".length,t=Math.ceil(a/2),i=Math.floor(a/2);return e.substr(0,t)+"..."+e.substr(e.length-i)},d(document).on("click",".yz-delete-attachment",function(e){var a=d(this).closest(".yz-attachment-item"),t=d.parseJSON(a.find(".yz-attachment-data").val()),i=d.map(t,function(e){return e.file_name});a.remove(),d.yz_DeleteAttachment(i[0])}),d.yz_DeleteAttachment=function(e){var a=new FormData;a.append("attachment",e),a.append("action","yz_delete_wall_attachment"),a.append("security",r.find('input[name="security"]').val()),d.ajax({type:"POST",data:a,url:Youzer.ajax_url,contentType:!1,processData:!1})},d.yz_CheckIsFileImage=function(e){var a=e.type;return!(d.inArray(a,["image/gif","image/jpeg","image/png"])<0)},d.yz_CheckUploadProgress=function(){d(".youzer .yz-file-progress")[0]||(d("#yz-upload-attachments").val(""),r.find(".yz-wall-post").attr("disabled",!1),e=0,t=null)},d.yz_check_for_uploader_button=function(){"status"!=d('input:radio[name="post_type"]').val()&&d(".yz-wall-actions .yz-wall-upload-btn").fadeIn()},d.yz_check_for_uploader_button(),d('input:radio[name="post_type"]').change(function(){d(this).is(":checked")&&"link"==d(this).val()?d(".yz-wall-link-form").fadeIn():d(".yz-wall-link-form").fadeOut(),d(this).is(":checked")&&"quote"==d(this).val()?d(".yz-wall-quote-form").fadeIn():d(".yz-wall-quote-form").fadeOut(),d(this).is(":checked")&&"status"!=d(this).val()?d(".yz-wall-actions .yz-wall-upload-btn").fadeIn():d(".yz-wall-actions .yz-wall-upload-btn").fadeOut(),d(".yz-attachment-item").remove()}),d.yz_isPostType=function(e){return e==d('input:radio[name="post_type"]:checked').val()},d.yz_CheckFilesNumber=function(){return"photo"==d('input:radio[name="post_type"]:checked').val()||"slideshow"==d('input:radio[name="post_type"]:checked').val()||!d(".yz-attachment-item")[0]||(d.yz_DialogMsg("error",Yz_Wall.max_one_file),!1)}}),d(document).on("click",".yz-trigger-who-modal",function(e){d(".yz-wall-modal-overlay").fadeIn(500,function(){d(this).find(".yz-modal-loader").fadeIn(400)}),e.preventDefault();var a={action:"yz_get_who_liked_post",post_id:d(this).data("who-liked")};jQuery.post(Youzer.ajax_url,a,function(e){d("#yz-wall-modal").append(e).find(".yz-wall-modal").addClass("yz-wall-modal-show"),d(".yz-wall-modal-overlay").find(".yz-modal-loader").hide()})}),d(document).keyup(function(e){return d(".yz-wall-modal-show")[0]&&27===e.keyCode&&d(".yz-wall-modal-close").trigger("click"),!1}),d(document).mouseup(function(e){return d(".yz-wall-modal-overlay").is(e.target)&&d(".yz-wall-modal-show")[0]&&d(".yz-wall-modal-close").trigger("click"),!1})}(jQuery);